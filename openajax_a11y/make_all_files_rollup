#!/usr/bin/env bash

# exit_on_error:
#   If set to 0, the script will run until reaching the end, without
#   regard to the detection of warnings or errors by JavaScript Lint.
#   If set to 1, the script will exit immediately after a warning or
#   error is detected by JavaScript Lint.

exit_on_error=0

# check_status_code: Process the return status of call to JavaScript
# Lint. When exit_on_error is set to 1 and the return status is non-
# zero, the function prints the JavaScript Lint message that corresponds
# to the status code and then terminates execution of the script.

function check_status_code() {
  code=$?
  case $code in
    (0) msg="Success" ;;
    (1) msg="JavaScript warnings" ;;
    (2) msg="Usage or configuration error" ;;
    (3) msg="JavaScript error" ;;
    (4) msg="File error" ;;
  esac

  if [[ $exit_on_error == 1 && $code != 0 ]] ; then
    echo
    echo JavaScript Lint message: $msg
    exit $code
  fi
}

# JSLINT function: A wrapper for calls to JavaScript Lint that allows
# additional processing based on the status code of each call. In this
# script, the function is only called when the environment variable
# JSLINT is defined.

function JSLINT() {
  $JSLINT $1
  check_status_code
}


echo "... Creating a11y evaluation library ..."

rollup \
openajax_a11y_constants.js \
language/language_codes.js \
wai_aria/aria.js           \
wai_aria/aria_in_html.js       \
scripts/cache_util.js      \
scripts/cache_abbreviations.js  \
scripts/cache_color_contrast.js \
scripts/cache_controls.js      \
scripts/cache_dom_element.js   \
scripts/cache_dom_traversal.js \
scripts/cache_frames.js        \
scripts/cache_headings_landmarks.js \
scripts/cache_images.js    \
scripts/cache_languages.js \
scripts/cache_links.js     \
scripts/cache_lists.js     \
scripts/cache_media.js     \
scripts/cache_style.js     \
scripts/cache_tables.js    \
scripts/cache_text.js      \
scripts/cache_keyboard_focus.js \
scripts/cache_timing.js    \
scripts/cache_page_information.js \
scripts/information_items.js \
scripts/result_summary.js \
scripts/evaluation_result.js \
scripts/rule_result.js \
scripts/element_result.js \
scripts/filtered_cache_item_results.js \
scripts/rule_group_results.js \
scripts/cache_nls.js \
scripts/rule_category_nls.js \
scripts/wcag20_nls.js \
openajax_a11y.js  \
scripts/rule_manager.js \
scripts/ruleset_manager.js \
scripts/evaluator.js \
nls/en-US/cache_nls.js \
nls/en-US/rule_category_nls.js \
nls/en-US/wcag20_nls.js  \
nls/en-US/rules_nls_common.js \
nls/en-US/rules_nls_audio.js \
nls/en-US/rules_nls_bypass.js \
nls/en-US/rules_nls_color.js \
nls/en-US/rules_nls_error_feedback.js \
nls/en-US/rules_nls_focus.js \
nls/en-US/rules_nls_form_controls.js \
nls/en-US/rules_nls_frames.js \
nls/en-US/rules_nls_images.js \
nls/en-US/rules_nls_headings.js \
nls/en-US/rules_nls_html.js \
nls/en-US/rules_nls_keyboard.js \
nls/en-US/rules_nls_landmarks.js \
nls/en-US/rules_nls_language.js \
nls/en-US/rules_nls_layout.js \
nls/en-US/rules_nls_links.js \
nls/en-US/rules_nls_lists.js \
nls/en-US/rules_nls_navigation.js \
nls/en-US/rules_nls_reading_order.js \
nls/en-US/rules_nls_resize.js \
nls/en-US/rules_nls_roles.js \
nls/en-US/rules_nls_sensory.js \
nls/en-US/rules_nls_tables.js \
nls/en-US/rules_nls_timing.js \
nls/en-US/rules_nls_title.js \
nls/en-US/rules_nls_video.js \
nls/en-US/rules_nls_widgets.js \
rules/rules_audio.js \
rules/rules_bypass.js \
rules/rules_color.js \
rules/rules_error_feedback.js \
rules/rules_focus.js \
rules/rules_form_controls.js \
rules/rules_frames.js \
rules/rules_images.js \
rules/rules_headings.js \
rules/rules_html.js \
rules/rules_keyboard.js \
rules/rules_landmarks.js \
rules/rules_language.js \
rules/rules_layout.js \
rules/rules_links.js \
rules/rules_lists.js \
rules/rules_navigation.js \
rules/rules_reading_order.js \
rules/rules_resize.js \
rules/rules_roles.js \
rules/rules_sensory.js \
rules/rules_tables.js \
rules/rules_timing.js \
rules/rules_title.js \
rules/rules_video.js \
rules/rules_widgets.js \
rulesets/test_ruleset.js \
rulesets/wcag20_aria_transitional_ruleset.js \
rulesets/wcag20_aria_strict_ruleset.js -o a11y-evaluation-library.js

echo
if [ $exit_on_error == 1 ]
then
  echo No JavaScript Lint warnings or errors detected!
else
  echo Note: JavaScript Lint exit_on_error feature was not enabled.
fi
